# name: test/sql/databricks/write.test
# description: test
# group: [databricks]

# Require statement will ensure this test is run with this extension loaded
require parquet

require uc_catalog

require delta

require httpfs

require-env DATABRICKS_TOKEN

require-env DATABRICKS_ENDPOINT

require-env DATABRICKS_REGION

statement ok
CREATE SECRET (
    TYPE UC,
    TOKEN '${DATABRICKS_TOKEN}',
    ENDPOINT '${DATABRICKS_ENDPOINT}',
    AWS_REGION '${DATABRICKS_REGION}'
);

# Attach to databricks through the unity catalog API
statement ok
ATTACH 'duckdb_test_4' (TYPE UC_CATALOG);

# Can query a table
statement ok
from duckdb_test_4.test_schema.test_table;

# TODO: make a function to fetch a delta path instead of this hardcoding
statement ok
COPY (select 1 as a) to "s3://duckdb-databricks-testing-2/test_schema/test_table/test2.parquet"

statement ok
INSERT INTO duckdb_test_4.test_schema.test_table VALUES (7, 'd');

statement ok
FROM duckdb_test_4.test_schema.test_table
