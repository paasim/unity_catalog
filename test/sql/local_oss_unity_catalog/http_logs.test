# name: test/sql/test_headers_parsed.test
# description: This test triggers the http prefetch mechanism.
# group: [sql]

require parquet

require uc_catalog

require delta

require httpfs

require-env UC_TEST_SERVER_RUNNING

statement ok
CALL enable_logging('HTTP');

statement ok
CREATE SECRET (
    TYPE UC,
    TOKEN 'not-used',
    ENDPOINT 'http://127.0.0.1:8080',
    AWS_REGION 'us-east-2'
);

# Catalog Secret
statement ok
ATTACH 'unity' AS my_catalog (TYPE UC_CATALOG);

# We can now query the tables in the schema!
query I
SELECT count(*) FROM my_catalog.default.marksheet;
----
15

query II sort
SELECT response.status, parse_path(request.url)[-1]
	FROM duckdb_logs_parsed('HTTP') 
	WHERE request.url LIKE '%/unity-catalog/%';
----
OK_200	schemas?catalog_name=unity
OK_200	tables?catalog_name=unity&schema_name=default
